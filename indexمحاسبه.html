<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة بيانات الوكلاء</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #f0f2f5, #e0e7ff);
            color: #1f2937;
            direction: rtl;
        }

        h1 {
            text-align: center;
            color: #1e3a8a;
            font-size: 1.8rem;
            margin: 1rem 0;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .table-wrapper {
            overflow-x: auto; /* Enable horizontal scrolling on small screens */
            margin-top: 1rem;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            min-width: 600px; /* Ensure table doesn't collapse too much */
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            min-width: 80px; /* Prevent columns from becoming too narrow */
        }

        th {
            background: linear-gradient(to bottom, #3b82f6, #2563eb);
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        td {
            background: #ffffff;
            transition: background-color 0.3s ease;
        }

        tr:hover td {
            background: #f9fafb;
        }

        input, button {
            padding: 8px 12px;
            margin: 4px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: 'Tajawal', sans-serif;
            box-sizing: border-box;
        }

        input {
            background: #f9fafb;
            color: #1f2937;
            width: 100%;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        button {
            background: #3b82f6;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-weight: 500;
            min-height: 44px; /* Touch-friendly size */
        }

        button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        .form-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 8px;
            margin-bottom: 1rem;
            background: #f9fafb;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .error {
            color: #dc2626;
            font-size: 0.85rem;
            margin: 0.5rem 0;
            text-align: center;
        }

        .action-buttons button {
            margin: 0 4px;
            padding: 6px 10px;
            font-size: 0.8rem;
            min-height: 36px;
        }

        #addButton {
            background: #22c55e;
        }

        #addButton:hover {
            background: #16a34a;
        }

        #updateButton {
            display: none;
            background: #f59e0b;
        }

        #updateButton:hover {
            background: #d97706;
        }

        #importButton {
            background: #8b5cf6;
        }

        #importButton:hover {
            background: #7c3aed;
        }

        #printButton {
            background: #ec4899;
        }

        #printButton:hover {
            background: #db2777;
        }

        .report-button {
            background: #ef4444;
        }

        .report-button:hover {
            background: #dc2626;
        }

        .total-debt {
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e3a8a;
            text-align: left;
        }

        .search-container {
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
        }

        #searchInput {
            width: 100%;
            max-width: 300px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            font-size: 0.95rem;
        }

        #importFile {
            display: none;
        }

        /* Extra small screens (phones, ≤480px) */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 0.5rem;
            }

            .form-container {
                grid-template-columns: 1fr;
                gap: 6px;
                padding: 0.75rem;
            }

            input, button {
                padding: 6px 10px;
                font-size: 0.9rem;
                margin: 3px;
            }

            .action-buttons button {
                padding: 5px 8px;
                font-size: 0.75rem;
                min-height: 32px;
            }

            th, td {
                padding: 6px;
                font-size: 0.75rem;
                min-width: 60px;
            }

            .search-container {
                padding: 0 0.5rem;
            }

            #searchInput {
                max-width: 100%;
            }

            /* Hide report buttons on very small screens to reduce clutter */
            .report-button {
                display: none;
            }
        }

        /* Medium screens (tablets, ≤768px) */
        @media (max-width: 768px) {
            .container {
                padding: 0.75rem;
            }

            .form-container {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 8px;
                min-width: 70px;
            }

            .action-buttons button {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: #ffffff;
                padding: 0;
            }

            .form-container, .error, #printButton, .action-buttons, .report-button, .search-container {
                display: none;
            }

            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
                background: none;
                border: none;
            }

            .total-debt {
                margin-top: 1rem;
                page-break-before: avoid;
                color: #000000;
            }

            .table-wrapper {
                overflow-x: visible;
            }

            table {
                margin-top: 0;
                box-shadow: none;
                min-width: auto;
            }

            th {
                background: #4b5563;
            }

            th, td {
                border: 1px solid #000000;
                padding: 6px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>إدارة بيانات الوكلاء</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="ابحث عن وكيل بالاسم" oninput="searchAgents()">
        </div>
        <div class="form-container">
            <input type="text" id="agentName" placeholder="اسم الوكيل">
            <input type="date" id="date" placeholder="تاريخ">
            <input type="number" id="totalAmount" placeholder="إجمالي المبلغ المطلوب">
            <input type="number" id="paidAmount" placeholder="المبلغ المسدد">
            <input type="number" id="previousMonthDebt" placeholder="ديون الشهر السابق">
            <input type="number" id="allowedDebtPercentage" placeholder="نسبة الديون المسموحة (%)">
            <button id="addButton" onclick="addAgent()">إضافة وكيل</button>
            <button id="updateButton" onclick="updateAgent()">تحديث الوكيل</button>
            <button onclick="saveToJson()">حفظ البيانات</button>
            <input type="file" id="importFile" accept=".json" onchange="importFromJson(event)">
            <button id="importButton" onclick="document.getElementById('importFile').click()">استيراد نسخة احتياطية</button>
            <button id="printButton" onclick="printStatement()">طباعة كشف الحسابات</button>
            <button class="report-button" onclick="generateTotalReport()">تقرير إجمالي المبالغ</button>
            <button class="report-button" onclick="generateDetailsReport()">تقرير تفاصيل كل مبالغ</button>
            <button class="report-button" onclick="generateMonthlyReport()">تقرير إجمالي المبالغ الشهرية</button>
            <button class="report-button" onclick="generateMovementReport()">تقرير حركة الحسابات</button>
        </div>
        <div id="error" class="error"></div>
        <div class="table-wrapper">
            <table id="agentsTable">
                <thead>
                    <tr>
                        <th>اسم الوكيل</th>
                        <th>تاريخ</th>
                        <th>إجمالي المبلغ المطلوب</th>
                        <th>المبلغ المسدد</th>
                        <th>المتبقي على الوكيل</th>
                        <th>ديون الشهر السابق</th>
                        <th>المتبقي من الشهر السابق</th>
                        <th>نسبة الديون المسموحة</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <div id="totalDebt" class="total-debt"></div>
    </div>

    <script>
        let agents = [];
        let logs = [];
        let editingAgentId = null;

        function loadAgents() {
            const savedData = localStorage.getItem('agents');
            if (savedData) {
                agents = JSON.parse(savedData);
            }
            const savedLogs = localStorage.getItem('logs');
            if (savedLogs) {
                logs = JSON.parse(savedLogs);
            }
            renderTable();
        }

        function saveAgents() {
            localStorage.setItem('agents', JSON.stringify(agents));
            localStorage.setItem('logs', JSON.stringify(logs));
        }

        function calculateTotalDebt(filteredAgents) {
            const totalDebt = filteredAgents.reduce((sum, agent) => {
                return sum + (agent.remainingAmount + agent.remainingPreviousMonth);
            }, 0);
            return totalDebt.toFixed(2);
        }

        function addLog(action, details) {
            const log = {
                timestamp: new Date().toLocaleString('ar'),
                action,
                details
            };
            logs.push(log);
            saveAgents();
        }

        function searchAgents() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const filteredAgents = agents.filter(agent => 
                agent.agentName.toLowerCase().includes(searchTerm)
            );
            renderTable(filteredAgents);
        }

        function addAgent() {
            const agentName = document.getElementById('agentName').value;
            const date = document.getElementById('date').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
            const previousMonthDebt = parseFloat(document.getElementById('previousMonthDebt').value) || 0;
            const allowedDebtPercentage = parseFloat(document.getElementById('allowedDebtPercentage').value) || 0;

            if (!agentName || !date || totalAmount < 0 || paidAmount < 0 || previousMonthDebt < 0 || allowedDebtPercentage < 0 || allowedDebtPercentage > 100) {
                document.getElementById('error').innerText = 'يرجى إدخال بيانات صحيحة (نسبة الديون المسموحة يجب ألا تتجاوز 100%)';
                return;
            }

            const remainingAmount = totalAmount - paidAmount;
            const remainingPreviousMonth = previousMonthDebt > 0 ? Math.max(0, previousMonthDebt - paidAmount) : 0;

            const agent = {
                id: Date.now(),
                agentName,
                date,
                totalAmount,
                paidAmount,
                remainingAmount,
                previousMonthDebt,
                remainingPreviousMonth,
                allowedDebtPercentage
            };

            agents.push(agent);
            addLog('إضافة وكيل', `اسم: ${agentName}, تاريخ: ${date}, إجمالي: ${totalAmount}`);
            saveAgents();
            renderTable();
            clearInputs();
            document.getElementById('error').innerText = '';
        }

        function editAgent(id) {
            const agent = agents.find(agent => agent.id === id);
            if (agent) {
                editingAgentId = id;
                document.getElementById('agentName').value = agent.agentName;
                document.getElementById('date').value = agent.date;
                document.getElementById('totalAmount').value = agent.totalAmount;
                document.getElementById('paidAmount').value = agent.paidAmount;
                document.getElementById('previousMonthDebt').value = agent.previousMonthDebt;
                document.getElementById('allowedDebtPercentage').value = agent.allowedDebtPercentage;
                document.getElementById('addButton').style.display = 'none';
                document.getElementById('updateButton').style.display = 'inline-block';
                document.getElementById('error').innerText = '';
            }
        }

        function updateAgent() {
            if (editingAgentId === null) return;

            const agentName = document.getElementById('agentName').value;
            const date = document.getElementById('date').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            const paidAmount = parseFloat(document.getElementById('paidAmount').value) || 0;
            const previousMonthDebt = parseFloat(document.getElementById('previousMonthDebt').value) || 0;
            const allowedDebtPercentage = parseFloat(document.getElementById('allowedDebtPercentage').value) || 0;

            if (!agentName || !date || totalAmount < 0 || paidAmount < 0 || previousMonthDebt < 0 || allowedDebtPercentage < 0 || allowedDebtPercentage > 100) {
                document.getElementById('error').innerText = 'يرجى إدخال بيانات صحيحة (نسبة الديون المسموحة يجب ألا تتجاوز 100%)';
                return;
            }

            const remainingAmount = totalAmount - paidAmount;
            const remainingPreviousMonth = previousMonthDebt > 0 ? Math.max(0, previousMonthDebt - paidAmount) : 0;

            agents = agents.map(agent => {
                if (agent.id === editingAgentId) {
                    addLog('تعديل وكيل', `اسم: ${agentName}, تاريخ: ${date}, إجمالي: ${totalAmount}`);
                    return {
                        id: agent.id,
                        agentName,
                        date,
                        totalAmount,
                        paidAmount,
                        remainingAmount,
                        previousMonthDebt,
                        remainingPreviousMonth,
                        allowedDebtPercentage
                    };
                }
                return agent;
            });

            saveAgents();
            renderTable();
            clearInputs();
            editingAgentId = null;
            document.getElementById('addButton').style.display = 'inline-block';
            document.getElementById('updateButton').style.display = 'none';
            document.getElementById('error').innerText = '';
        }

        function deleteAgent(id) {
            const agent = agents.find(agent => agent.id === id);
            if (agent) {
                addLog('حذف وكيل', `اسم: ${agent.agentName}, تاريخ: ${agent.date}`);
            }
            agents = agents.filter(agent => agent.id !== id);
            saveAgents();
            renderTable();
        }

        function renderTable(filteredAgents = agents) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            filteredAgents.forEach(agent => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${agent.agentName}</td>
                    <td>${agent.date}</td>
                    <td>${agent.totalAmount.toFixed(2)}</td>
                    <td>${agent.paidAmount.toFixed(2)}</td>
                    <td>${agent.remainingAmount.toFixed(2)}</td>
                    <td>${agent.previousMonthDebt.toFixed(2)}</td>
                    <td>${agent.remainingPreviousMonth.toFixed(2)}</td>
                    <td>${agent.allowedDebtPercentage}%</td>
                    <td class="action-buttons">
                        <button onclick="editAgent(${agent.id})">تعديل</button>
                        <button onclick="deleteAgent(${agent.id})">حذف</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            const totalDebtElement = document.getElementById('totalDebt');
            totalDebtElement.innerText = `مجموع الديون الكلي: ${calculateTotalDebt(filteredAgents)}`;
        }

        function clearInputs() {
            document.getElementById('agentName').value = '';
            document.getElementById('date').value = '';
            document.getElementById('totalAmount').value = '';
            document.getElementById('paidAmount').value = '';
            document.getElementById('previousMonthDebt').value = '';
            document.getElementById('allowedDebtPercentage').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('importFile').value = '';
        }

        function saveToJson() {
            const dataStr = JSON.stringify({agents, logs}, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agents_data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importFromJson(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (importedData.agents && Array.isArray(importedData.agents) && importedData.agents.every(agent => 
                            agent.id && agent.agentName && agent.date && 
                            typeof agent.totalAmount === 'number' && 
                            typeof agent.paidAmount === 'number' && 
                            typeof agent.remainingAmount === 'number' && 
                            typeof agent.previousMonthDebt === 'number' && 
                            typeof agent.remainingPreviousMonth === 'number' && 
                            typeof agent.allowedDebtPercentage === 'number'
                        ) && importedData.logs && Array.isArray(importedData.logs)) {
                            agents = importedData.agents;
                            logs = importedData.logs;
                            saveAgents();
                            renderTable();
                            document.getElementById('error').innerText = 'تم استيراد البيانات بنجاح';
                            clearInputs();
                        } else {
                            document.getElementById('error').innerText = 'ملف JSON غير صالح';
                        }
                    } catch (error) {
                        document.getElementById('error').innerText = 'خطأ في تحميل الملف: ' + error.message;
                    }
                };
                reader.readAsText(file);
            } else {
                document.getElementById('error').innerText = 'يرجى اختيار ملف JSON صالح';
            }
        }

        function printStatement() {
            window.print();
        }

        function generateTotalReport() {
            const totals = agents.reduce((acc, agent) => {
                acc.totalAmount += agent.totalAmount;
                acc.paidAmount += agent.paidAmount;
                acc.remainingAmount += agent.remainingAmount;
                acc.previousMonthDebt += agent.previousMonthDebt;
                acc.remainingPreviousMonth += agent.remainingPreviousMonth;
                return acc;
            }, { totalAmount: 0, paidAmount: 0, remainingAmount: 0, previousMonthDebt: 0, remainingPreviousMonth: 0 });

            const reportHtml = `
                <html dir="rtl">
                <head><title>تقرير إجمالي المبالغ</title></head>
                <body>
                    <h1>تقرير إجمالي المبالغ</h1>
                    <table border="1">
                        <tr><th>إجمالي المبلغ المطلوب</th><td>${totals.totalAmount.toFixed(2)}</td></tr>
                        <tr><th>المبلغ المسدد</th><td>${totals.paidAmount.toFixed(2)}</td></tr>
                        <tr><th>المتبقي على الوكلاء</th><td>${totals.remainingAmount.toFixed(2)}</td></tr>
                        <tr><th>ديون الشهر السابق</th><td>${totals.previousMonthDebt.toFixed(2)}</td></tr>
                        <tr><th>المتبقي من الشهر السابق</th><td>${totals.remainingPreviousMonth.toFixed(2)}</td></tr>
                        <tr><th>مجموع الديون الكلي</th><td>${(totals.remainingAmount + totals.remainingPreviousMonth).toFixed(2)}</td></tr>
                    </table>
                </body>
                </html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
            reportWindow.print();
        }

        function generateDetailsReport() {
            let tableRows = '';
            agents.forEach(agent => {
                tableRows += `
                    <tr>
                        <td>${agent.agentName}</td>
                        <td>${agent.date}</td>
                        <td>${agent.totalAmount.toFixed(2)}</td>
                        <td>${agent.paidAmount.toFixed(2)}</td>
                        <td>${agent.remainingAmount.toFixed(2)}</td>
                        <td>${agent.previousMonthDebt.toFixed(2)}</td>
                        <td>${agent.remainingPreviousMonth.toFixed(2)}</td>
                        <td>${agent.allowedDebtPercentage}%</td>
                    </tr>
                `;
            });

            const reportHtml = `
                <html dir="rtl">
                <head><title>تقرير تفاصيل كل مبالغ</title></head>
                <body>
                    <h1>تقرير تفاصيل كل مبالغ</h1>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>اسم الوكيل</th>
                                <th>تاريخ</th>
                                <th>إجمالي المبلغ المطلوب</th>
                                <th>المبلغ المسدد</th>
                                <th>المتبقي على الوكيل</th>
                                <th>ديون الشهر السابق</th>
                                <th>المتبقي من الشهر السابق</th>
                                <th>نسبة الديون المسموحة</th>
                            </tr>
                        </thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </body>
                </html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
            reportWindow.print();
        }

        function generateMonthlyReport() {
            const monthlyTotals = {};
            agents.forEach(agent => {
                const dateObj = new Date(agent.date);
                const monthKey = `${dateObj.getFullYear()}-${(dateObj.getMonth() + 1).toString().padStart(2, '0')}`;
                if (!monthlyTotals[monthKey]) {
                    monthlyTotals[monthKey] = { totalAmount: 0, paidAmount: 0, remainingAmount: 0, previousMonthDebt: 0, remainingPreviousMonth: 0 };
                }
                monthlyTotals[monthKey].totalAmount += agent.totalAmount;
                monthlyTotals[monthKey].paidAmount += agent.paidAmount;
                monthlyTotals[monthKey].remainingAmount += agent.remainingAmount;
                monthlyTotals[monthKey].previousMonthDebt += agent.previousMonthDebt;
                monthlyTotals[monthKey].remainingPreviousMonth += agent.remainingPreviousMonth;
            });

            let tableRows = '';
            for (const month in monthlyTotals) {
                const totals = monthlyTotals[month];
                tableRows += `
                    <tr>
                        <td>${month}</td>
                        <td>${totals.totalAmount.toFixed(2)}</td>
                        <td>${totals.paidAmount.toFixed(2)}</td>
                        <td>${totals.remainingAmount.toFixed(2)}</td>
                        <td>${totals.previousMonthDebt.toFixed(2)}</td>
                        <td>${totals.remainingPreviousMonth.toFixed(2)}</td>
                        <td>${(totals.remainingAmount + totals.remainingPreviousMonth).toFixed(2)}</td>
                    </tr>
                `;
            }

            const reportHtml = `
                <html dir="rtl">
                <head><title>تقرير إجمالي المبالغ الشهرية</title></head>
                <body>
                    <h1>تقرير إجمالي المبالغ الشهرية</h1>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>الشهر</th>
                                <th>إجمالي المبلغ المطلوب</th>
                                <th>المبلغ المسدد</th>
                                <th>المتبقي على الوكلاء</th>
                                <th>ديون الشهر السابق</th>
                                <th>المتبقي من الشهر السابق</th>
                                <th>مجموع الديون</th>
                            </tr>
                        </thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </body>
                </html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
            reportWindow.print();
        }

        function generateMovementReport() {
            let tableRows = '';
            logs.forEach(log => {
                tableRows += `
                    <tr>
                        <td>${log.timestamp}</td>
                        <td>${log.action}</td>
                        <td>${log.details}</td>
                    </tr>
                `;
            });

            const reportHtml = `
                <html dir="rtl">
                <head><title>تقرير حركة الحسابات</title></head>
                <body>
                    <h1>تقرير حركة الحسابات</h1>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>التاريخ والوقت</th>
                                <th>الإجراء</th>
                                <th>التفاصيل</th>
                            </tr>
                        </thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </body>
                </html>
            `;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
            reportWindow.print();
        }

        window.onload = loadAgents;
    </script>
</body>
</html>
